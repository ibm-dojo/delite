<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>Slider unit tests</title>

	<link href="../icons/commonIcons.css" rel="stylesheet"/>

	<!-- For testing purposes.  Real applications should load the AMD loader directly -->
	<script type="text/javascript" src="./boilerplate.js"></script>

	<script type="text/javascript">
		submittedValues = null;
		defaultSubmitHandler = null;

		require([
			"doh/runner",
			"dojo/sniff",
			"dojo/on",
			"dojo/keys",
			"dojo/_base/window",
			"dojo/dom",
			"dojo/dom-style",
			"dojo/dom-geometry",
			"dojo/dom-form",
			"dojo/aspect",
			"dui/register",
			"dui/Rule",
			"dui/Slider",
			"dojo/domReady!"
		], function(doh, has, on, keys, win, dom, domStyle, domGeometry, domForm, aspect, register, Rule, Slider){

			defaultSubmitHandler = function(values){
				for(var i in values){ console.debug(i + " = " + values[i]); }
			};
			submittedValues = defaultSubmitHandler;

			register.parse();

			var Ltr2 = dom.byId("Ltr2");
			on(dom.byId("enableLtr2"), "click",
				function () {
					Ltr2.disabled = false;
				}
			);

			var form = dom.byId("myForm");
//			form.reset(); // restore values to the defaults
			var customH = dom.byId("customH");
//			var Rtl1 = dom.byId("Rtl1");
			var Btt1 = dom.byId("Btt1");
			var customV = dom.byId("customV");
			var Ltr1 = dom.byId("Ltr1");
			var a11yRtl1 = dom.byId("a11yRtl1");
			var Btt2 = dom.byId("Btt2");
			var a11yTtb2 = dom.byId("a11yTtb2");

			var hasTouch = has("touch");
			var msPointer = navigator.msPointerEnabled;
			var touchstart = msPointer?"MSPointerDown":"touchstart";
			var touchmove = msPointer?"MSPointerMove":"touchmove";
			var touchend = msPointer?"MSPointerUp":"touchend";
			var transitionDuration = has("webkit")?"WebkitTransitionDuration":"transitionDuration";
			var touchEvent = null;
			var touchTarget = null;

			var Rtl1 = new Slider({
				id: "Rtl1",
				name: "Rtl1",
				value: "10",
				orientation: "H",
				flip: true,
				min: "0",
				max: "20",
				onchange: function (v) {
					document.getElementById("val").innerHTML=String(this.value).replace(/(\.\d)\d*/g,"$1");
				}
			}).placeAt("Rtl1_spot");
			Rtl1.value = "15";
			Rtl1.startup();

			var test = /mode=test/i.test(window.location.href);
			if(!test){ return; }

			function getZoom(widget){
				var bodyZoom = domStyle.get(win.body(), "zoom") || 1;
				var nodeZoom = (has("ie") ? parseFloat(domStyle.get(widget).getPropertyValue("zoom"))/100 : domStyle.get(widget, "zoom")) || 1;
				return nodeZoom * bodyZoom;
			}
			function fireTouchEvent(type, widget, x, y, delay){
				function doit(){
					if(type == touchend){
						if(!hasTouch && !msPointer){ type = "mouseup"; }
						on.emit(touchTarget, type, touchEvent);
						return;
					}
					var node = widget.containerNode;
					var handle = widget.handle;
					var zoom = getZoom(widget);
					if(has("ie")){
						x *= zoom;
						y *= zoom;
						zoom = 1;
					}
					var scroll = domGeometry.docScroll();
					var pos = domGeometry.position(node, false);
					var handlePos = domGeometry.position(handle, false);
					handlePos.l = handlePos.x * zoom + scroll.x;
					handlePos.t = handlePos.y * zoom + scroll.y;
					handlePos.r = handlePos.l + (handlePos.w - 1) * zoom;
					handlePos.b = handlePos.t + (handlePos.h - 1) * zoom;
					var touchX = (x + pos.x) * zoom + scroll.x;
					var touchY = (y + pos.y) * zoom + scroll.y;
					if(type == touchstart){
						touchTarget = widget;
						// see if handle is under the touch pos
						if(touchX >= handlePos.l && touchX <= handlePos.r && touchY >= handlePos.t && touchY <= handlePos.b){
							touchTarget = handle;
						}
					}
					touchEvent = document.createEvent ? document.createEvent("Events") : document.createEventObject();
					if(!hasTouch && !msPointer){
						switch(type){
							case touchstart: type = "mousedown"; break;
							case touchmove: type = "mousemove"; break;
							case touchend: type = "mouseup"; break;
						}
					}
					if(document.createEvent){
						touchEvent.initEvent(type, true, true);
					}
					touchEvent.touches = [ { pageX: touchX, pageY: touchY } ];
					touchEvent.pageX = touchX;
					touchEvent.pageY = touchY;
					touchEvent.changedTouches = touchEvent.touches;
					on.emit(touchTarget, type, touchEvent);
				}
				if(delay){
					setTimeout(doit, delay);
				}else{
					doit();
				}
			}
			var Ltr1_width = Ltr1.containerNode.offsetWidth;
			var Ltr1_height = Ltr1.containerNode.offsetHeight;
			var Ltr1_handle_width = Ltr1.handle.offsetWidth;
			var Btt1_width = Btt1.containerNode.offsetWidth;
			var Btt1_height = Btt1.containerNode.offsetHeight;
			var Btt1_handle_height = Btt1.handle.offsetHeight;
			var handle;
			var speed = 0; // should be 0 unless it's a demo
			domStyle.set(Ltr1.progressBar, transitionDuration, (speed >> 1) + "ms");
			domStyle.set(Btt1.progressBar, transitionDuration, (speed >> 1) + "ms");

			function pushKey(node, key){
				on.emit(node, "keydown", {
					keyCode: key,
					altKey:false, ctrlKey:false, metaKey:false, cancelable: true, bubbles: true
				});
				on.emit(node, "keyup", {
					keyCode: key,
					altKey:false, ctrlKey:false, metaKey:false, cancelable: true, bubbles: true
				});
			}

			doh.register("values", [
				{
					timeout:3000,
					name:"startup",
					runTest:function(){
						doh.is("10,15", Ltr2.value, "widget Ltr2");
						doh.is("5,15", customH.value, "widget customH");
						doh.is("15", Rtl1.value, "widget Rtl1");
						doh.is("10", Btt1.value, "widget Btt1");
						doh.is("10", customV.value, "widget customV");
						doh.is("15", Ltr1.value, "widget Ltr1");
						doh.is("15", a11yRtl1.value, "widget a11yRtl1");
						doh.is("0,10", Btt2.value, "widget Btt2");
						doh.is("0,10", a11yTtb2.value, "widget a11yTtb2");
						var d = new doh.Deferred();
						submittedValues = function(formValues){
							d.getTestCallback(function(){
								doh.is(null, formValues["Ltr2"], "submit Ltr2");
								doh.is("5,15", formValues["customH"], "submit customH");
								doh.is("15", formValues["Rtl1"], "submit Rtl1");
								doh.is("10", formValues["Btt1"], "submit Btt1");
								doh.is("10", formValues["customV"], "submit customV");
								doh.is(null, formValues["Ltr1"], "submit Ltr1");
								doh.is(null, formValues["a11yRtl1"], "submit a11yRtl1");
								doh.is(null, formValues["Btt2"], "submit Btt2");
								doh.is(null, formValues["a11yTtb2"], "submit a11yTtb2");
							})();
						};
						setTimeout(function(){ form.submit(); }, 1); // return before submit
						return d;
					},
					tearDown: function(){
						submittedValues = defaultSubmitHandler;
					}
				},
				{
					timeout:3000,
					name:"disable",
					runTest:function(){
						doh.is(true, !!Ltr2.valueNode.disabled, "Ltr2 valueNode disabled");
						doh.is(3, Ltr2.tabIndex, "Ltr2 widget tabIndex #1");
						doh.is(null, Ltr2.getAttribute("tabIndex"), "Ltr2 domNode tabIndex #1");
						doh.is(null, Ltr2.handle.getAttribute("tabIndex"), "Ltr2 handle tabIndex #1");
						doh.is(false, !!customH.valueNode.disabled, "customH valueNode enabled");
						doh.is(0, customH.tabIndex, "customH widget tabIndex #1");
						doh.is(null, customH.getAttribute("tabIndex"), "customH domNode tabIndex #1");
						doh.is(0, customH.handle.getAttribute("tabIndex"), "customH handle tabIndex #1");
						Ltr2.disabled = false;
						customH.disabled = true;
						doh.is(false, !!Ltr2.valueNode.disabled, "Ltr2 valueNode enabled");
						doh.is(3, Ltr2.tabIndex, "Ltr2 widget tabIndex #2");
						doh.is(null, Ltr2.getAttribute("tabIndex"), "Ltr2 domNode tabIndex #2");
						doh.is(3, Ltr2.handle.getAttribute("tabIndex"), "Ltr2 handle tabIndex #2");
						doh.is(true, !!customH.valueNode.disabled, "customH valueNode disabled");
						doh.is(0, customH.tabIndex, "customH widget tabIndex #2");
						doh.is(null, customH.getAttribute("tabIndex"), "customH domNode tabIndex #2");
						doh.is(null, customH.handle.getAttribute("tabIndex"), "customH handle tabIndex #2");
						var d = new doh.Deferred();
						submittedValues = function(formValues){
							d.getTestCallback(function(){
								doh.is("10,15", formValues["Ltr2"], "submit Ltr2");
								doh.is(null, formValues["customH"], "submit customH");
							})();
						};
						setTimeout(function(){ form.submit(); }, 1); // return before submit
						return d;
					},
					tearDown: function(){
						submittedValues = defaultSubmitHandler;
					}
				},
				{
					timeout:1000,
					name:"tabIndex",
					runTest:function(){
						doh.is(0, Rtl1.tabIndex, "Rtl1 widget tabIndex #1");
						doh.is(null, Rtl1.getAttribute("tabIndex"), "Rtl1 domNode tabIndex #1");
						doh.is(0, Rtl1.handle.getAttribute("tabIndex"), "Rtl1 handle tabIndex #1");
						Ltr2.tabIndex = 1;
						customH.tabIndex = 2;
						Rtl1.tabIndex = 3;
						doh.is(3, Rtl1.tabIndex, "Rtl1 widget tabIndex #2");
						doh.is(null, Rtl1.getAttribute("tabIndex"), "Rtl1 domNode tabIndex #2");
						doh.is(3, Rtl1.handle.getAttribute("tabIndex"), "Rtl1 handle tabIndex #2");
						doh.is(1, Ltr2.tabIndex, "Ltr2 widget tabIndex");
						doh.is(null, Ltr2.getAttribute("tabIndex"), "Ltr2 domNode tabIndex");
						doh.is(1, Ltr2.handle.getAttribute("tabIndex"), "Ltr2 handle tabIndex");
						doh.is(2, customH.tabIndex, "customH widget tabIndex");
						doh.is(null, customH.getAttribute("tabIndex"), "customH domNode tabIndex");
						doh.is(null, customH.handle.getAttribute("tabIndex"), "customH handle tabIndex");
					}
				},
				{
					timeout:3000,
					name:"keyboard",
					runTest:function(){
						customH.disabled = false;
						pushKey(Ltr2.handleMin, keys.HOME);
						pushKey(customH.handle, keys.END);
						pushKey(Btt2.handleMin, keys.HOME);
						pushKey(a11yTtb2.handle, keys.END);
						pushKey(Ltr1.handle, keys.RIGHT_ARROW);
						pushKey(Rtl1.handle, keys.RIGHT_ARROW);
						pushKey(Btt1.handle, keys.DOWN_ARROW);
						pushKey(customV.handle, keys.DOWN_ARROW);
						pushKey(Ltr2.handle, keys.LEFT_ARROW);
						pushKey(customH.handleMin, keys.LEFT_ARROW);
						pushKey(a11yTtb2.handleMin, keys.UP_ARROW);
						pushKey(Btt2.handle, keys.UP_ARROW);
						var d = new doh.Deferred();
						submittedValues = function(formValues){
							d.getTestCallback(function(){
								doh.is("0,14.875", Ltr2.value, "widget Ltr2");
								doh.is("6,20", customH.value, "widget customH");
								doh.is("14", Rtl1.value, "widget Rtl1");
								doh.is("9.875", Btt1.value, "widget Btt1");
								doh.is("10.125", customV.value, "widget customV");
								doh.is("16", Ltr1.value, "widget Ltr1");
								doh.is("-20,10.125", Btt2.value, "widget Btt2");
								doh.is("-0.125,20", a11yTtb2.value, "widget a11yTtb2");
								doh.is("0,14.875", formValues["Ltr2"], "submit Ltr2");
								doh.is("6,20", formValues["customH"], "submit customH");
								doh.is("14", formValues["Rtl1"], "submit Rtl1");
								doh.is("9.875", formValues["Btt1"], "submit Btt1");
								doh.is("10.125", formValues["customV"], "submit customV");
							})();
						};
						setTimeout(function(){ form.submit(); }, 1); // return before submit
						return d;
					},
					tearDown: function(){
						submittedValues = defaultSubmitHandler;
					}
				},
				{
					timeout:3000,
					name:"set extreme values",
					runTest:function(){
						Ltr2.value = "-100,100";
						customH.value = "100";
						Rtl1.value = "100";
						Btt1.value = "-100";
						doh.is("0,20", Ltr2.value, "widget Ltr2");
						doh.is("0,20", customH.value, "widget customH");
						doh.is("20", Rtl1.value, "widget Rtl1");
						doh.is("-20", Btt1.value, "widget Btt1");
						var d = new doh.Deferred();
						submittedValues = function(formValues){
							d.getTestCallback(function(){
								doh.is("0,20", formValues["Ltr2"], "submit Ltr2");
								doh.is("0,20", formValues["customH"], "submit customH");
								doh.is("20", formValues["Rtl1"], "submit Rtl1");
								doh.is("-20", formValues["Btt1"], "submit Btt1");
							})();
						};
						setTimeout(function(){ form.submit(); }, 1); // return before submit
						return d;
					},
					tearDown: function(){
						submittedValues = defaultSubmitHandler;
					}
				}
			]);

			doh.register("tap", [
				{
					name: "horizontal end",
					timeout: 1000+speed,
					runTest: function(){
						function onchange(v){
							d.getTestCallback(function(){
								doh.is(v, Ltr1.max);
							})();
						}
						var d = new doh.Deferred();
						handle = aspect.after(Ltr1, "onchange", onchange, true);
						fireTouchEvent(touchstart, Ltr1, Ltr1_width, Ltr1_height >> 1, speed);
						fireTouchEvent(touchend);
						return d;
					},
					tearDown: function(){
						handle.remove();
					}
				},
				{
					name: "horizontal start",
					timeout: 1000+speed,
					runTest: function(){
						function onchange(v){
							d.getTestCallback(function(){
								doh.is(v, Ltr1.min);
							})();
						}
						var d = new doh.Deferred();
						handle = aspect.after(Ltr1, "onchange", onchange, true);
						fireTouchEvent(touchstart, Ltr1, 0, Ltr1_height >> 1, speed);
						fireTouchEvent(touchend);
						return d;
					},
					tearDown: function(){
						handle.remove();
					}
				},
				{
					name: "horizontal middle",
					timeout: 1000+speed,
					runTest: function(){
						function onchange(v){
							d.getTestCallback(function(){
								doh.t(Math.abs(v - ((Ltr1.max+Ltr1.min) >> 1)) <= Ltr1.step);
							})();
						}
						var d = new doh.Deferred();
						handle = aspect.after(Ltr1, "onchange", onchange, true);
						fireTouchEvent(touchstart, Ltr1, Ltr1_width >> 1, Ltr1_height >> 1, speed);
						fireTouchEvent(touchend);
						return d;
					},
					tearDown: function(){
						handle.remove();
					}
				},
				{
					name: "vertical end",
					timeout: 2000+speed,
					runTest: function(){
						function onchange(v){
							d.getTestCallback(function(){
								doh.is(v, Btt1.max);
							})();
						}
						var d = new doh.Deferred();
						handle = aspect.after(Btt1, "onchange", onchange, true);
						fireTouchEvent(touchstart, Btt1, Btt1_width >> 1, 0, speed);
						fireTouchEvent(touchend);
						return d;
					},
					tearDown: function(){
						handle.remove();
					}
				},
				{
					name: "vertical start",
					timeout: 2000+speed,
					runTest: function(){
						function onchange(v){
							d.getTestCallback(function(){
								doh.is(v, Btt1.min);
							})();
						}
						var d = new doh.Deferred();
						handle = aspect.after(Btt1, "onchange", onchange, true);
						fireTouchEvent(touchstart, Btt1, Btt1_width >> 1, Btt1_height, speed);
						fireTouchEvent(touchend);
						return d;
					},
					tearDown: function(){
						handle.remove();
					}
				},
				{
					name: "vertical middle",
					timeout: 1000+speed,
					runTest: function(){
						function onchange(v){
							d.getTestCallback(function(){
								doh.t(Math.abs(v - ((Btt1.max+Btt1.min) >> 1)) <= Btt1.step);
							})();
						}
						var d = new doh.Deferred();
						handle = aspect.after(Btt1, "onchange", onchange, true);
						fireTouchEvent(touchstart, Btt1, Btt1_width >> 1, Btt1_height >> 1, speed);
						fireTouchEvent(touchend);
						return d;
					},
					tearDown: function(){
						handle.remove();
					}
				}
			]);

			doh.register("move", [
				{
					name: "horizontal right",
					timeout: 1000+speed*2,
					runTest: function(){
						function onchange(v){
							d.getTestCallback(function(){
								doh.is(v, Ltr1.max);
							})();
						}
						var d = new doh.Deferred();
						handle = aspect.after(Ltr1, "onchange", onchange, true);
						fireTouchEvent(touchstart, Ltr1, Ltr1_width >> 1, Ltr1_height >> 1);
						fireTouchEvent(touchmove, Ltr1, Ltr1_width, Ltr1_height >> 1, speed);
						fireTouchEvent(touchend);
						return d;
					},
					tearDown: function(){
						handle.remove();
					}
				},
				{
					name: "horizontal left",
					timeout: 1000+speed*2,
					runTest: function(){
						function onchange(v){
							d.getTestCallback(function(){
								doh.is(v, Ltr1.min);
							})();
						}
						var d = new doh.Deferred();
						handle = aspect.after(Ltr1, "onchange", onchange, true);
						fireTouchEvent(touchstart, Ltr1, Ltr1_width, Ltr1_height >> 1);
						fireTouchEvent(touchmove, Ltr1, 0, Ltr1_height >> 1, speed);
						fireTouchEvent(touchend);
						return d;
					},
					tearDown: function(){
						handle.remove();
					}
				},
				{
					name: "vertical up",
					timeout: 1000+speed,
					runTest: function(){
						function onchange(v){
							d.getTestCallback(function(){
								doh.is(Btt1.max, v);
							})();
						}
						var d = new doh.Deferred();
						handle = aspect.after(Btt1, "onchange", onchange, true);
						fireTouchEvent(touchstart, Btt1, Btt1_width >> 1, Btt1_height >> 1);
						fireTouchEvent(touchmove, Btt1, Btt1_width >> 1, 0, speed);
						fireTouchEvent(touchend);
						return d;
					},
					tearDown: function(){
						handle.remove();
					}
				},
				{
					name: "vertical down",
					timeout: 1000+speed,
					runTest: function(){
						function onchange(v){
							d.getTestCallback(function(){
								doh.is(Btt1.min, v);
							})();
						}
						var d = new doh.Deferred();
						handle = aspect.after(Btt1, "onchange", onchange, true);
						fireTouchEvent(touchstart, Btt1, Btt1_width >> 1, Btt1_height >> 1);
						fireTouchEvent(touchmove, Btt1, Btt1_width >> 1, Btt1_height, speed);
						fireTouchEvent(touchend);
						return d;
					},
					tearDown: function(){
						handle.remove();
					}
				}
			]);

			doh.register("click handle", [
				{
					name: "horizontal right",
					timeout: 1000+speed,
					runTest: function(){
						var mid = (Ltr1.max + Ltr1.min) >> 1;
						Ltr1.value = mid;
						doh.is(mid, Ltr1.value, "initial value");
						var d = new doh.Deferred();
						fireTouchEvent(touchstart, Ltr1, (Ltr1_width >> 1) + (Ltr1_handle_width >> 2), Ltr1_height >> 1, speed);
						fireTouchEvent(touchend);
						setTimeout(d.getTestCallback(function(){
							doh.is(mid, Ltr1.value, "right value");
						}), 500+speed);
						return d;
					}
				},
				{
					name: "horizontal left",
					timeout: 1000+speed,
					runTest: function(){
						var mid = (Ltr1.max + Ltr1.min) >> 1;
						var d = new doh.Deferred();
						fireTouchEvent(touchstart, Ltr1, (Ltr1_width >> 1) - (Ltr1_handle_width >> 2), Ltr1_height >> 1);
						fireTouchEvent(touchend);
						setTimeout(d.getTestCallback(function(){
							doh.is(mid, Ltr1.value, "left value");
						}), 500+speed);
						return d;
					}
				},
				{
					name: "horizontal change right",
					timeout: 1000+speed,
					runTest: function(){
						var mid = (Ltr1.max + Ltr1.min) >> 1;
						var d = new doh.Deferred();
						fireTouchEvent(touchstart, Ltr1, (Ltr1_width >> 1) + (Ltr1_handle_width >> 1) + 2, Ltr1_height >> 1, speed >> 1);
						fireTouchEvent(touchend);
						setTimeout(d.getTestCallback(function(){
							doh.t(Ltr1.value > mid, "right changed value " + Ltr1.value);
						}), 500+speed);
						return d;
					}
				},
				{
					name: "horizontal change left",
					timeout: 1000+speed,
					runTest: function(){
						var mid = (Ltr1.max + Ltr1.min) >> 1;
						var d = new doh.Deferred();
						fireTouchEvent(touchstart, Ltr1, (Ltr1_width >> 1) - ((Ltr1_handle_width >> 1) + 2), Ltr1_height >> 1, speed >> 1);
						fireTouchEvent(touchend);
						setTimeout(d.getTestCallback(function(){
							doh.t(Ltr1.value < mid, "left changed value " + Ltr1.value);
						}), 500+speed);
						return d;
					}
				},
				{
					name: "vertical bottom",
					timeout: 1000+speed,
					runTest: function(){
						var mid = (Btt1.max + Btt1.min) >> 1;
						Btt1.value = mid;
						doh.is(mid, Btt1.value, "initial value");
						var d = new doh.Deferred();
						fireTouchEvent(touchstart, Btt1, Btt1_width >> 1, (Btt1_height >> 1) + (Btt1_handle_height >> 2), speed);
						fireTouchEvent(touchend);
						setTimeout(d.getTestCallback(function(){
							doh.is(mid, Btt1.value, "bottom value");
						}), 500+speed);
						return d;
					}
				},
				{
					name: "vertical top",
					timeout: 1000+speed,
					runTest: function(){
						var mid = (Btt1.max + Btt1.min) >> 1;
						var d = new doh.Deferred();
						fireTouchEvent(touchstart, Btt1, Btt1_width >> 1, (Btt1_height >> 1) - (Btt1_handle_height >> 2));
						fireTouchEvent(touchend);
						setTimeout(d.getTestCallback(function(){
							doh.is(mid, Btt1.value, "top value");
						}), 500+speed);
						return d;
					}
				},
				{
					name: "vertical change bottom",
					timeout: 1000+speed,
					runTest: function(){
						var mid = (Btt1.max + Btt1.min) >> 1;
						Btt1.value = mid;
						doh.is(mid, Btt1.value, "initial value");
						var d = new doh.Deferred();
						fireTouchEvent(touchstart, Btt1, Btt1_width >> 1, (Btt1_height >> 1) + (Btt1_handle_height >> 1) + 2, speed >> 1);
						fireTouchEvent(touchend);
						setTimeout(d.getTestCallback(function(){
							doh.t(Btt1.value < mid, "bottom changed value " + Btt1.value);
						}), 500+speed);
						return d;
					}
				},
				{
					name: "vertical change top",
					timeout: 1000+speed,
					runTest: function(){
						var mid = (Btt1.max + Btt1.min) >> 1;
						Btt1.value = mid;
						doh.is(mid, Btt1.value, "initial value");
						var d = new doh.Deferred();
						fireTouchEvent(touchstart, Btt1, Btt1_width >> 1, (Btt1_height >> 1) - ((Btt1_handle_height >> 1) + 2), speed >> 1);
						fireTouchEvent(touchend);
						setTimeout(d.getTestCallback(function(){
							doh.t(Btt1.value > mid, "top changed value " + Btt1.value);
						}), 500+speed);
						return d;
					}
				}
			]);

			if(has("webkit") || has("ie") >= 10){
				doh.register("animation", {
					name: "horizontal 100%",
					timeout: 3000,
					runTest: function(){
						var d = new doh.Deferred();
						Ltr1.value = Ltr1.min;
						var startX = Math.round(domGeometry.position(Ltr1.handle).x), midX, endX;
						domStyle.set(Ltr1.progressBar, transitionDuration, "1000ms");
						Ltr1.value = Ltr1.max;
						setTimeout(function(){
							midX = domGeometry.position(Ltr1.handle).x;
						}, 400); 
						setTimeout(d.getTestCallback(function(){
							endX = Math.round(domGeometry.position(Ltr1.handle).x);
							doh.t(midX > startX, "started sliding");
							doh.t(midX < endX, "continued sliding");
							var zoom = has("ie") ? getZoom(sh) : 1;
							var distance = domGeometry.position(Ltr1.containerNode).w * zoom;
							doh.t(Math.abs(Math.abs(endX-startX)-distance) <= 3, "stopped sliding end="+endX+",start="+startX+",width="+distance);
						}), 2100);
						return d;
					},
					tearDown: function(){
						domStyle.set(Ltr1.handle, transitionDuration, (speed >> 1) + "ms");
					}
				})
			}

			doh.register("reset", {
				timeout:3000,
				name:"reset",
				runTest:function(){
					form.reset();
					var d = new doh.Deferred();
					setTimeout(d.getTestCallback(function(){
						doh.is("10,15", Ltr2.value, "widget Ltr2");
						doh.is("5,15", customH.value, "widget customH");
						doh.is("15", Rtl1.value, "widget Rtl1");
						doh.is("10", Btt1.value, "widget Btt1");
						doh.is("10", customV.value, "widget customV");
						doh.is("15", Ltr1.value, "widget Ltr1");
						doh.is("15", a11yRtl1.value, "widget a11yRtl1");
						doh.is("0,10", Btt2.value, "widget Btt2");
						doh.is("0,10", a11yTtb2.value, "widget a11yTtb2");
					}), 1);
					return d;
				}
			});

			doh.register("log", function(){
				dom.byId("failures").innerHTML = doh._failureCount;
				dom.byId("errors").innerHTML = doh._errorCount;
			});

			doh.run();
		});
	</script>

	<style>
TD {
	vertical-align: middle;
	margin: auto;
	text-align: -webkit-center;
	text-align: center;
}

/* fake a11y */

.dj_a11y * {
	background-image: none !important;
	background-color: transparent !important;
	color: black !important;
	border-color: black !important;
}

/* instance specific custom rules */

/* remove odd marks and labels from top decoration */
.customLabels d-rule.duiRule:nth-of-type(-n+2) > div:nth-child(odd) {
	visibility: hidden; /* remove first, middle and last top rule marks since they have no labels */
}
/* create lots of custom rules to make sure full customization is possible */
.custom .duiSlider {
	border: 5px inset gray;
	padding: 10px;
	background-color: #c8c8c8;
}
.custom .duiSliderH {
	width: 100%;
}
.custom .duiSliderV {
	height: 100%;
}
.custom .duiSliderH .duiSliderRemainingBar {
	width: 100%;
}
.custom .duiSliderV .duiSliderRemainingBar {
	height: 100%;
}
.custom .duiSliderRemainingBar {
	background-color: black;
	background-image: none;
}
.custom .duiSliderH .duiSliderProgressBar {
	background-image: url("images/progressBarAnim.gif");
}
.custom .duiSliderV .duiSliderProgressBar {
	background: red;
}
.custom .duiSliderHandle {
	border-color: transparent;
}
.custom .duiSliderH .duiSliderHandle {
	width: 18px;
	height: 18px;
	background: url("images/sliderHthumb.png") no-repeat center center;
}
.custom .duiSliderV .duiSliderHandle {
	width: 18px;
	height: 18px;
	background: url("images/sliderVthumb.png") no-repeat center right;
}
.custom .duiSliderH .duiSliderHandle {
        top: -5.5px;
}
.custom .duiSliderV .duiSliderHandle {
        left: -5px;
}
.custom .duiSliderRtl .duiSliderHandleMax,
.custom .duiSliderLtr .duiSliderHandleMin {
	left: -9px;
}
.custom .duiSliderRtl .duiSliderHandleMin,
.custom .duiSliderLtr .duiSliderHandleMax {
	right: -9px;
}
.custom .duiSliderTtb .duiSliderHandleMax,
.custom .duiSliderBtt .duiSliderHandleMin {
	bottom: -9px;
}
.custom .duiSliderTtb .duiSliderHandleMin,
.custom .duiSliderBtt .duiSliderHandleMax {
	top: -9px;
}

	</style>
</head>
<body style="zoom:2.0;background-color:#888888;font-size:9pt;">
	<form id="myForm" method="GET" action="resources/formAction.html" target="formSubmitIframe">
		<br>
		<center><table>
			<tr>
				<td colspan=3 class="customLabels"><d-slider id="Ltr2" value="10,15" orientation="H" isRange disabled tabIndex="3" min="0" max="20" step="0.125" onchange='document.getElementById("val").innerHTML=String(this.value).replace(/(\.\d)\d*/g,"$1")' style='width:90%' >
					<input name="Ltr2">
					<d-rule class="duiRuleBefore" count="5" style='font-size:5px; font-weight:bold; margin:-3.5px 0;'></d-rule>
					<d-rule class="duiRuleBefore" style='font-size:10px; margin:-8px 0;' >
						<div></div>
						<div>5</div>
						<div></div>
						<div>15</div>
						<div></div>
					</d-rule>
					<d-rule count="3" style='font-size:5px; font-weight:bold; margin:3px 0;'></d-rule>
					<d-rule class="duiRuleAfter" style='font-size:10px; margin:8px 0;' >
						<div>0</div>
						<div>10</div>
						<div>20</div>
					</d-rule>
				</d-slider><button id="enableLtr2" type="button">Enable</button></td>
			</tr>
			<tr>
				<td>20</td>
				<td class="custom" style="width:110pt;"><d-slider id="customH" value="5,15" orientation="H" isRange flip min="0" max="20" step="1.0" onchange='document.getElementById("val").innerHTML=String(this.value).replace(/(\.\d)\d*/g,"$1")'><input name="customH"></d-slider></td>
				<td>0</td>
			</tr>
			<tr>
				<td>20</td>
				<td><div id="Rtl1_spot"></div></td>
				<td>0</td>
			</tr>
			<tr>
				<td>0</td>
				<td><d-slider id="Ltr1" value="15" min="0" max="20" step="1.0" onchange='document.getElementById("val").innerHTML=String(this.value).replace(/(\.\d)\d*/g,"$1")'><input></d-slider></td>
				<td>20</td>
			</tr>
			<tr>
				<td>20</td>
				<td class="dj_a11y"><d-slider id="a11yRtl1" flip min="0" max="20" step="1.0" onchange='document.getElementById("val").innerHTML=String(this.value).replace(/(\.\d)\d*/g,"$1")'><input value="15"></d-slider></td>
				<td>0</td>
			</tr>
		</table></center>
		<br>
		<center><table style="width:100%;height:250px;"><tr>
			<td style="width:50px;" class="customLabels"><div style="height:250px;">
				<d-slider id="Btt1" value="10" orientation="V" min="-20" max="20" step="0.125" onchange='document.getElementById("val").innerHTML=String(this.value).replace(/(\.\d)\d*/g,"$1")'>
					<input name="Btt1">
					<d-rule class="duiRuleAfter" count="5" style='font-size:5px; font-weight:bold; margin:0 3px;'></d-rule>
					<d-rule style='font-size:10px; margin:0 9px;' >
						<div></div>
						<div>25%</div>
						<div></div>
						<div>75%</div>
						<div></div>
					</d-rule>
					<d-rule class="duiRuleBefore" count="3" style='font-size:5px; font-weight:bold; margin:0 -3px;'></d-rule>
					<d-rule class="duiRuleBefore" style='font-size:10px; margin:0 -9px;' >
						<div>low</div>
						<div>normal</div>
						<div>high</div>
					</d-rule>
				</d-slider>
			</div></td>
			<td style="width:50px;"><div class="custom" style="height:110pt;">
				-20<br>
				<d-slider id="customV" value="10" name="customV" orientation="V" flip min="-20" max="20" step="0.125" onchange='document.getElementById("val").innerHTML=String(this.value).replace(/(\.\d)\d*/g,"$1")'></d-slider>
				<br>20
			</div></td>
			<td style="width:50px;"><div style="height:100%;">
				20<br>
				<d-slider id="Btt2" value="0,10" orientation="V" isRange min="-20" max="20" step="0.125" onchange='document.getElementById("val").innerHTML=String(this.value).replace(/(\.\d)\d*/g,"$1")'><input></d-slider>
				<br>-20
			</div></td>
			<td style="width:50px;" class="dj_a11y" ><div style="height:100%;">
				-20<br>
				<d-slider id="a11yTtb2" orientation="V" isRange flip min="-20" max="20" step="0.125" onchange='document.getElementById("val").innerHTML=String(this.value).replace(/(\.\d)\d*/g,"$1")'><input value="0,10"></d-slider>
				<br>20
			</div></td>
		</tr></table></center>
		<br>
		<br>
		Value:&nbsp;<span id="val">?</span>
		<br>
		<input type=submit>
		<input type=reset>
	</form>
	<br>
	Errors:&nbsp;<span id="errors">?</span><br>
	Failures:&nbsp;<span id="failures">?</span>
<iframe name="formSubmitIframe" src="about:blank" onload="if(this.values)submittedValues(this.values)" style="display:none;"></iframe>
</body>
</html>
