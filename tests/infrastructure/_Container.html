<!DOCTYPE html>
<html>
<head>

	<meta http-equiv="Content-type" content="text/html; charset=utf-8">

	<title>Container</title>

	<script type="text/javascript" src="../boilerplate.js"></script>
	<script type="text/javascript">
		require([
			"doh/runner",
			"dojo/dom", "dojo/parser",
			"dui/a11y", "dui/focus", "dui/register", "dui/_WidgetBase", "dui/_Container", "dui/_Contained",
			"dui/tests/helpers", "dojo/domReady!"
		], function(doh, dom, parser, a11y, focus, register, _WidgetBase, _Container, _Contained, helpers){

			PlainWidget = register("plain-widget", [HTMLElement, _WidgetBase], {});

			TestContainer = register("test-container", [HTMLElement, _WidgetBase, _Container], {});

			TestContained = register("test-contained", [HTMLElement, _WidgetBase, _Contained], {});

			doh.register("parse", function(){
				register.parse();
			});

			doh.register("basic tests", [
				{
					name: "getChildren",
					runTest: function(t){
						var c = dom.byId("container");
						var children = c.getChildren();
						t.is(5, children.length);
						t.is("zero", children[0].id);
						t.is("one", children[1].id);
						t.is("two", children[2].id);
						t.is("three", children[3].id);
						t.is("four", children[4].id);
					}
				},
				{
					name: "getIndexOfChild",
					runTest: function(t){
						var c = dom.byId("container");
						t.is(0, c.getIndexOfChild(dom.byId("zero")));
						t.is(1, c.getIndexOfChild(dom.byId("one")));
						t.is(2, c.getIndexOfChild(dom.byId("two")));
						t.is(3, c.getIndexOfChild(dom.byId("three")));
						t.is(4, c.getIndexOfChild(dom.byId("four")));
						t.is(-1, c.getIndexOfChild(dom.byId("outside")));
						t.is(-1, c.getIndexOfChild(dom.byId("outsideCont")));
					}
				},
				{
					name: "getIndexInParent",
					runTest: function(t){
						t.is(0, dom.byId("zero").getIndexInParent());
						t.is(1, dom.byId("one").getIndexInParent());
						t.is(2, dom.byId("two").getIndexInParent());
						t.is(-1, dom.byId("outsideCont").getIndexInParent());
					}
				},
				{
					name: "removeChild",
					runTest: function(t){
						var c = dom.byId("container");
						var children = c.getChildren();
						t.is(5, children.length);
						zero = dom.byId("zero");
						c.removeChild(zero);
						two = dom.byId("two");
						c.removeChild(1); // should remove "two" - because zero is already removed
						four = dom.byId("four");
						c.removeChild(four);
						children = c.getChildren();
						t.is(2, children.length);
						t.is("one", children[0].id);
						t.is("three", children[1].id);
					}
				},
				{
					name: "addChild",
					runTest: function(t){
						var c = dom.byId("container");

						// Add child at beginning
						c.addChild(zero, 0);
						children = c.getChildren();
						t.is(3, children.length);
						t.is("zero", children[0].id, "after addChild(zero), zero");
						t.is("one", children[1].id, "after addChild(zero), one");
						t.is("three", children[2].id, "after addChild(zero), three");

						// Add child in middle
						c.addChild(two, 2);
						children = c.getChildren();
						t.is(4, children.length);
						t.is("zero", children[0].id, "after addChild(two), zero");
						t.is("one", children[1].id, "after addChild(two), one");
						t.is("two", children[2].id, "after addChild(two), two");
						t.is("three", children[3].id, "after addChild(two), three");

						// Add a DOMNode at the end
						c.addChild(four);
						children = c.getChildren();
						t.is(5, children.length);
						t.is("zero", children[0].id, "after addChild(four), zero");
						t.is("one", children[1].id, "after addChild(four), one");
						t.is("two", children[2].id, "after addChild(four), two");
						t.is("three", children[3].id, "after addChild(four), three");
						t.is("four", children[4].id, "after addChild(four), four");

						// Add child at end
						c.addChild(new TestContained({id: "five"}));
						children = c.getChildren();
						t.is(6, children.length);
						t.is("zero", children[0].id, "after addChild(five), zero");
						t.is("one", children[1].id, "after addChild(five), one");
						t.is("two", children[2].id, "after addChild(five), two");
						t.is("three", children[3].id, "after addChild(five), three");
						t.is("four", children[4].id, "after addChild(five), four");
						t.is("five", children[5].id, "after addChild(five), five");

						// Add child at end with explicit position specified
						c.addChild(new TestContained({id: "six"}), 6);
						children = c.getChildren();
						t.is(7, children.length);
						t.is("zero", children[0].id, "after addChild(six), zero");
						t.is("one", children[1].id, "after addChild(six), one");
						t.is("two", children[2].id, "after addChild(six), two");
						t.is("three", children[3].id, "after addChild(six), three");
						t.is("four", children[4].id, "after addChild(six), four");
						t.is("five", children[5].id, "after addChild(six), five");
						t.is("six", children[6].id, "after addChild(six), five");
					}
				}
			]);

			doh.run();
		});

	</script>
</head>
<body class="claro">

<label for="input">before:</label><input id="input"/>
<test-container id="container">
	<!-- comment just to make sure that numbering isn't thrown off -->
	<test-contained id="zero"></test-contained>
	<test-contained id="one"></test-contained>
	<test-contained id="two"></test-contained>
	<plain-widget id="three"></plain-widget>
	<!-- at least for now it needs to have a widget ID to be returned by getChildren() -->
	<div id="four" widgetId="four"></div>
</test-container>
<plain-widget id="outside"></plain-widget>
<test-contained id="outsideCont"></test-contained>
</body>
</html>
